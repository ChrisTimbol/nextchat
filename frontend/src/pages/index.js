import Head from 'next/head'
import Image from 'next/image'
import styles from '@/styles/Home.module.css'
import { io } from "socket.io-client"
import { useEffect, useState } from 'react'

const socket = io('http://localhost:8000')

export default function Home() {
  const [chatText, setChatText] = useState("") // chat Typed in input
  const [chatPrint, setChatPrint] = useState([]) // chat received from server

  // sends 'chatText' to server with socket.emit func
  const handlePost = (e) => { // 
    socket.emit("chatToServer", { chatText })
  }

  // server listener for 'chatToClient' 
  socket.on('chatToClient', (data) => {
    // check if data is empty string
    if(data) setChatPrint([...chatPrint, data]) 
    setChatText("") // resetChatText
  })

  return (
    <>
      <Head>
        <title>Chat app</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="" />
      </Head>
      <main className={styles.main}>

        {/* input for the user . onChange setsChatText state  */}
        <input type="text" value={chatText} onChange={(e) => setChatText(e.target.value)}></input>
        {/* When button is clicked it calls handlePost() */}
        <button onClick={handlePost}>Send</button>
{/*         {console.log(JSON.stringify(chatPrint))} */}
         {chatPrint.map ((e) => (
            <div><li>{e.chatText}</li></div>
        ))} 
        <br />

      </main>
    </>
  )
}
//https://nextjs.org/docs/advanced-features/custom-server